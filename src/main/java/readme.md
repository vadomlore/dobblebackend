网关扮演分发玩家到不同的服务器。

如根据玩家IP， 地区， 直接分配玩家到login server 中， 也会选择相对应的服务器。 各个地区需要有各个地区不同的网关服务

不支持全球大区同步。只支持某部分地区，可以分出多个login server

重复登录策略（必须走auth流程）（1.不能重复登录（需要有玩家很久没有操作之后自动下线的功能） 2.登录顶号（会将原有的账号顶掉） 过程（认证成功，这里掉线提示有玩家正在玩，（redis缓存中必有玩家数据）反复登录，
直到查询到玩家登录的缓存数据被清空，才可走登录流程。 设置玩家状态与此同时下线玩家，执行下线逻辑，保存玩家下线状态。清空缓存数据）

断线重连策略（不必走auth流程）。 1.根据游戏策略，选择是否支持

断线重连必须要有心跳机制。构想（断线时（比如断网），玩家处于disconnect状态，玩家session数据存储在本地， 不需要走auth 流程，只需要发session与玩家Id就可以直接进游戏。）

关于何时清空登陆凭据缓存记录？
1.正常logout
2.当玩家（AFK）时间到了，会被踢下线。（踢下线有踢下线的策略，比如说心跳机制，或者是多长时间玩家没有收到数据，内置定时器（比如Guava的定时缓存实现玩家下线）。

gateway 1<----------->n auth server（可以选择缓存），这里玩家的令牌会每隔24小时刷新一次，存入redis，

auth server 1<---chooser----->  n game server

client 1<----------->1 game server <访问redis 获取登录信息>

matching server 与玩家的数据会通过 Game server 传递消息（rabbitmq），通知玩家下线或者上线。（只有玩家真正在GameServer，才能够进行匹配，匹配服务器可以完成匹配多少局的统计（可以匹配玩家）
----->消息下发给Game server，-----（进入倒计时10s）--->Game server将消息下发给玩家，然后进入游戏（）顺便把消息返给匹配服务器匹配成功的信息）（是否略微复杂）？

gateway 扮演选择登录器的角色。 gatetay 做玩家分流， 可以将玩家分到不同的游戏世界（game server）中。相同game server 中的玩家自然可以游戏互通

game server 可以横向扩展。

大厅只能有一个。（大厅中有所有）

目前只有匹配模块，没有单独的匹配服务器。匹配在game server中进行。


服务器的选择按照人员选择（配置）。

整个游戏的架构是基于netty的多线程+消息队列的方式处理（估计瓶颈所在？）。以避免锁开销。等待商榷。

游戏是基于Tcp服务的，提供webapi入口访问，且支持接口不变的热更新操作。（目前不支持数据热更新）。

待支持高级特性。
自动将玩家映射到其他的服务器上面去

支持热更新，热替换



关于短线机制，如果服务器连着2次没有受到客户端的消息，服务器会主动向客户端发送心跳机制，客户端受到心跳如果没有立即回复，则服务器主动断开连接。



(达到的效果是无论谁先启动，都会建立连接完成双方的通信）。这里指定连接的Host是GateWayServer，客体是GameServer. GameServer给GatewayServer发送心跳消息
服务端GateWayServer 服务器启动过程

1.绑定端口,将信息注册到Redis//数据库中。

2.查询自己关心的其他服务器是否启动(数据库中, 如果GameServer 已经启动，则发送建立连接操作，与对端完成连接) 单独的线程轮询完成查询连接。目前此操作只在GateWayServer中主动寻找GameServer的信息。

Gateway连接建立成功之后会主动发送心跳到GameServer， 如果心跳停止。则修改（Mysql/Nosql中数据库记录的服务器活动信息,并且把自己内存中的服务器状态信息置为关闭)。随着心跳信息，GS会把当前的服务器状态汇报给Gateway。（Peggy）

3.GameServer Bind Listen完之后将自己的信息保存到(数据库中, redis或者mysql)。

如果Gateway关闭， 新的玩家不能进入游戏。（老的玩家可以正常退出），类似与闸门


如果GS正常关闭，会在关闭之前通知GateWay,（并且自己修改数据库中的记录） 如果GS异常退出，Gateway检测不到心跳，转步骤2。


GS一般很少主动向GateWay请求数据，一般情况是被动接收，并且汇报。


